import{r as f,s as k,d as T,e as w,V as y}from"./index-XAQY0n2C.js";function z(e,O={}){const[C,g]=f.useState(null),[D,p]=f.useState(!0),[a,n]=f.useState(null),{columns:c="*",filters:s={},order:d,limit:E,single:S=!1,cacheKey:i,cacheTTL:t,dependencies:o=[]}=O,h=f.useCallback(async()=>{p(!0);try{const $=()=>{let r=k.from(e).select(c);return Object.entries(s).forEach(([u,q])=>{if(typeof q=="object"&&q!==null){const[Q,l]=Object.entries(q)[0];switch(Q){case"eq":r=r.eq(u,l);break;case"neq":r=r.neq(u,l);break;case"gt":r=r.gt(u,l);break;case"lt":r=r.lt(u,l);break;case"gte":r=r.gte(u,l);break;case"lte":r=r.lte(u,l);break;case"like":r=r.like(u,l);break;case"ilike":r=r.ilike(u,l);break;case"in":r=r.in(u,l);break;default:r=r.eq(u,l)}}else r=r.eq(u,q)}),d&&(r=r.order(d.column,{ascending:d.ascending??!0})),E&&(r=r.limit(E)),S?r.single():r},{data:j,error:L}=await T(e,$,i||`${e}-${JSON.stringify({columns:c,filters:s,order:d,limit:E,single:S})}`,t);if(L)throw L;g(j)}catch($){console.error(`Error fetching data from ${e}:`,$),n($)}finally{p(!1)}},[e,c,JSON.stringify(s),JSON.stringify(d),E,S,i,t,...o]);f.useEffect(()=>{let $=!0;return(async()=>{await h()})(),()=>{$=!1}},[h]);const J=f.useCallback(()=>(i?w(i):w(`${e}-${JSON.stringify({columns:c,filters:s,order:d,limit:E,single:S})}`),h()),[h,i,e,c,s,d,E,S]);return{data:C,loading:D,error:a,refetch:J}}function M(e,O={}){const[C,g]=f.useState(!1),[D,p]=f.useState(null),{onSuccess:a,onError:n,invalidateQueries:c=[],showToast:s=!0}=O,d=f.useCallback(async i=>{g(!0);try{const{data:t,error:o}=await k.from(e).insert([i]).select().single();if(o)throw o;return c.forEach(h=>w(h)),w(e),s&&y.success(`${e} creado correctamente`),a&&a(t),t}catch(t){throw console.error(`Error creating ${e}:`,t),p(t),s&&y.error(`Error al crear ${e}`),n&&n(t),t}finally{g(!1)}},[e,a,n,c,s]),E=f.useCallback(async(i,t)=>{g(!0);try{const{data:o,error:h}=await k.from(e).update({...t,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(h)throw h;return c.forEach(J=>w(J)),w(e),s&&y.success(`${e} actualizado correctamente`),a&&a(o),o}catch(o){throw console.error(`Error updating ${e}:`,o),p(o),s&&y.error(`Error al actualizar ${e}`),n&&n(o),o}finally{g(!1)}},[e,a,n,c,s]),S=f.useCallback(async i=>{g(!0);try{const{error:t}=await k.from(e).delete().eq("id",i);if(t)throw t;return c.forEach(o=>w(o)),w(e),s&&y.success(`${e} eliminado correctamente`),a&&a({}),!0}catch(t){throw console.error(`Error deleting ${e}:`,t),p(t),s&&y.error(`Error al eliminar ${e}`),n&&n(t),t}finally{g(!1)}},[e,a,n,c,s]);return{create:d,update:E,remove:S,loading:C,error:D}}export{M as a,z as u};
