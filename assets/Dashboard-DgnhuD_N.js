import{c as p,R as q,r as c,s as n,j as e,L as _,C as $,U as O}from"./index-XAQY0n2C.js";import{u as U}from"./useSupabaseQuery-BySWxqua.js";import{D as A,f as E,p as I}from"./pl-C20WK1aG.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=p("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=p("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=p("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),K=()=>{const[s,k]=c.useState({}),[C,v]=c.useState(!0),i=c.useMemo(()=>{const t=new Date;return t.setDate(1),t.setHours(0,0,0,0),t},[]),{data:m,loading:S}=U("bookings",{columns:`
      id,
      customer_name,
      booking_date,
      booking_time,
      total_amount,
      status,
      service:service_id(name)
    `,order:{column:"created_at",ascending:!1},limit:5,cacheKey:"recent-bookings",cacheTTL:3e4});c.useEffect(()=>{R()},[i]);const R=async()=>{var t,a,d,r;try{v(!0);const[l,x,h,M,z,B]=await Promise.all([n.from("bookings").select("*",{count:"exact",head:!0}),n.from("bookings").select("*",{count:"exact",head:!0}).gte("created_at",i.toISOString()),n.from("bookings").select("total_amount").eq("status","confirmed"),n.from("bookings").select("total_amount").eq("status","confirmed").gte("created_at",i.toISOString()),n.from("bookings").select("customer_email",{count:"exact"}).order("customer_email"),n.from("bookings").select("customer_email").gte("created_at",i.toISOString())]),g=l.count||0,w=x.count||0,y=((t=h.data)==null?void 0:t.reduce((o,f)=>o+f.total_amount,0))||0,b=((a=M.data)==null?void 0:a.reduce((o,f)=>o+f.total_amount,0))||0,j=new Set((d=z.data)==null?void 0:d.map(o=>o.customer_email)).size,N=new Set((r=B.data)==null?void 0:r.map(o=>o.customer_email)).size,D=g?w/g*100-100:0,L=y?b/y*100-100:0,P=j?N/j*100-100:0;k({total_bookings:g,monthly_bookings:w,bookings_growth:D,total_customers:j,monthly_customers:N,customers_growth:P,total_revenue:y,monthly_revenue:b,revenue_growth:L})}catch(l){console.error("Error fetching dashboard data:",l)}finally{v(!1)}},u=c.useMemo(()=>({title:t,value:a,monthlyValue:d,growth:r,icon:l,iconBgColor:x,iconColor:h})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:t}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a})]}),e.jsx("div",{className:`p-3 ${x} rounded-full`,children:e.jsx(l,{className:`w-6 h-6 ${h}`})})]}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Ten miesiąc: ",d]}),e.jsxs("span",{className:`ml-2 text-xs font-medium flex items-center ${r>=0?"text-green-600":"text-red-600"}`,children:[r>=0?e.jsx(V,{className:"w-3 h-3 mr-1"}):e.jsx(T,{className:"w-3 h-3 mr-1"}),Math.abs(Math.round(r)),"%"]})]})]}),[]);return C&&!s.total_bookings?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(_,{className:"w-8 h-8 animate-spin text-gray-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Pulpit"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Podsumowanie wyników Twojego barbershopu"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(u,{title:"Wszystkie Rezerwacje",value:s.total_bookings||0,monthlyValue:s.monthly_bookings||0,growth:s.bookings_growth||0,icon:$,iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),e.jsx(u,{title:"Klienci",value:s.total_customers||0,monthlyValue:s.monthly_customers||0,growth:s.customers_growth||0,icon:O,iconBgColor:"bg-green-100",iconColor:"text-green-600"}),e.jsx(u,{title:"Całkowity Przychód",value:`${s.total_revenue||0} PLN`,monthlyValue:`${s.monthly_revenue||0} PLN`,growth:s.revenue_growth||0,icon:A,iconBgColor:"bg-red-100",iconColor:"text-red-600"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Popularne Usługi"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"3"})]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx(G,{className:"w-6 h-6 text-purple-600"})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-purple-600 h-2.5 rounded-full",style:{width:"70%"}})})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Ostatnie Rezerwacje"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:S?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(_,{className:"w-6 h-6 animate-spin text-gray-400"})}):m&&m.length>0?m.map(t=>{var a;return e.jsxs("div",{className:"p-6 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:t.customer_name}),e.jsx("p",{className:"text-sm text-gray-500",children:(a=t.service)==null?void 0:a.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[t.total_amount," PLN"]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.status==="confirmed"?"bg-green-100 text-green-800":t.status==="cancelled"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="confirmed"?"Potwierdzona":t.status==="cancelled"?"Anulowana":"Oczekująca"})]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[E(new Date(t.booking_date),"d MMMM",{locale:I})," • ",t.booking_time]})]},t.id)}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Brak ostatnich rezerwacji"})})]})]})},F=q.memo(K);export{F as default};
